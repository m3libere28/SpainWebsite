<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Valencia Adventure - Countdown to Spain!</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🇪🇸</text></svg>">

    <!-- Core Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: { 50: '#F0F7FF', 100: '#E0EFFF', 200: '#B8DBFF', 300: '#8AC2FF', 400: '#5CA9FF', 500: '#2E90FF', 600: '#0073FF', 700: '#0059CC', 800: '#004299', 900: '#002B66' },
                        accent: { 50: '#FFF7E6', 100: '#FFE9BF', 200: '#FFD580', 300: '#FFC140', 400: '#FFAD00', 500: '#FF9900', 600: '#CC7A00', 700: '#995C00', 800: '#663D00', 900: '#331F00' }
                    }
                }
            }
        }
    </script>

    <style>
        /* Use CSS variables derived from Tailwind config for consistency */
        :root {
            --primary: #2E90FF; /* primary-500 */
            --accent: #FF9900; /* accent-500 */
        }

        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3, h4, h5, h6 { font-family: 'Poppins', sans-serif; }

        .glass {
            background: rgba(255, 255, 255, 0.6); /* Slightly less transparent */
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        .dark .glass {
            background: rgba(31, 41, 55, 0.6); /* dark:bg-gray-800 */
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }

        .card {
            @apply bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl;
        }
         /* Enhanced hover effect */
        .card:hover {
            transform: translateY(-5px);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #F3F4F6; /* gray-100 */ }
        .dark ::-webkit-scrollbar-track { background: #1F2937; /* gray-800 */ }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #0073FF; /* primary-600 */ }

        /* Animations */
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-pulse-slow { animation: pulse 2.5s ease-in-out infinite; }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .slide-in-up { animation: slideInUp 0.6s ease-out forwards; }

        /* Loader fade out */
        #loader.fade-out { animation: fadeOut 0.5s forwards; }
        @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }

        /* Form elements basic styling */
        .form-input, .form-select, .form-textarea {
            @apply block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:ring-primary-500 focus:border-primary-500 transition duration-150 ease-in-out;
        }
        .btn-primary {
             @apply inline-flex items-center justify-center px-6 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition duration-150 ease-in-out;
        }
        .btn-secondary {
             @apply inline-flex items-center justify-center px-6 py-2 border border-gray-300 dark:border-gray-600 text-base font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition duration-150 ease-in-out;
        }

        /* Map container needs explicit size */
        #family-map-container { height: 400px; @apply rounded-lg z-0; }

        /* Splide Arrows Customization */
        .splide__arrow { background: var(--primary); opacity: 0.7; }
        .splide__arrow:hover { opacity: 1; }
        .splide__arrow svg { fill: white; }
        .splide__pagination__page.is-active { background: var(--primary); }

        /* Timeline Styling */
        .timeline-item { @apply relative; }
        .timeline-dot {
            @apply absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-4 h-4 bg-primary-500 rounded-full border-4 border-white dark:border-gray-800 z-10;
        }
        .timeline-content { @apply p-6 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md; }

        /* Active Nav Link */
        .nav-link.active { @apply text-primary-600 dark:text-primary-400 font-semibold; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <!-- Loading Screen -->
    <div id="loader" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-gradient-to-br from-primary-500 to-accent-500 text-white">
        <div class="text-center">
            <h1 class="text-4xl font-bold mb-6 animate-pulse-slow">Our Valencia Adventure</h1>
            <div class="relative">
                <i class="fas fa-plane-departure text-6xl text-white animate-float"></i>
                <div class="absolute w-24 h-2 bg-white/20 bottom-0 left-1/2 transform -translate-x-1/2 rounded-full blur-md"></div>
            </div>
            <p class="mt-4 text-lg">Preparing for takeoff...</p>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-40 glass">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex-shrink-0">
                     <a href="#home" class="text-2xl font-bold font-display text-primary-600 dark:text-primary-400 hover:opacity-80 transition-opacity">Valencia Bound</a>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-6">
                    <a href="#home" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors" aria-current="page">Home</a>
                    <a href="#rentals" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">Rentals</a>
                    <a href="#timeline" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">Timeline</a>
                    <a href="#weather" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">Weather</a>
                    <a href="#schools" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">Schools</a>
                     <!-- Add links for new sections -->
                    <a href="#budget" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">Budget</a>
                    <a href="#todo" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">To-Do</a>
                    <a href="#journal" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">Journal</a>
                </div>

                 <!-- Theme Toggle (Desktop) -->
                 <div class="hidden md:block">
                     <button id="theme-toggle-desktop" aria-label="Toggle Dark Mode" class="p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                         <i class="fas fa-sun text-lg"></i>
                     </button>
                 </div>

                <!-- Mobile Menu Button -->
                 <div class="md:hidden flex items-center">
                     <button id="theme-toggle-mobile" aria-label="Toggle Dark Mode" class="p-2 mr-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                         <i class="fas fa-sun text-lg"></i>
                     </button>
                     <button id="mobile-menu-button" aria-label="Open Menu" class="p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                         <i class="fas fa-bars text-xl"></i>
                     </button>
                 </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Navigation Menu -->
    <div id="mobile-menu" class="hidden fixed inset-0 z-30 md:hidden" role="dialog" aria-modal="true">
        <!-- Background backdrop, show/hide based on slide-over state -->
        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" aria-hidden="true" id="mobile-menu-overlay"></div>

        <!-- Mobile menu panel -->
        <div id="mobile-menu-panel" class="fixed top-0 right-0 bottom-0 w-64 bg-white dark:bg-gray-800 p-4 transform translate-x-full transition-transform duration-300 ease-in-out shadow-lg">
            <div class="flex justify-between items-center mb-6">
                <span class="text-lg font-semibold font-display">Menu</span>
                <button id="mobile-menu-close-button" aria-label="Close Menu" class="p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="flex flex-col space-y-3">
                <a href="#home" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Home</a>
                <a href="#rentals" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Rentals</a>
                <a href="#timeline" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Timeline</a>
                <a href="#weather" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Weather</a>
                <a href="#schools" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Schools</a>
                <a href="#budget" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Budget</a>
                <a href="#todo" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">To-Do</a>
                <a href="#journal" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Journal</a>
                <a href="#family-map" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Family</a>
                <a href="#bucket-list" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Bucket List</a>
                <a href="#resources" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Resources</a>
                <a href="#guestbook" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Guestbook</a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="pt-16">
        <!-- Hero Section -->
        <section id="home" class="relative min-h-[calc(100vh-4rem)] flex items-center justify-center bg-gradient-to-br from-primary-600 to-accent-600 text-white overflow-hidden">
            <div class="absolute inset-0 z-0">
                <!-- Valencia background video -->
                 <video autoplay muted loop playsinline class="object-cover w-full h-full opacity-25">
                    <source src="https://player.vimeo.com/external/539412434.sd.mp4?s=47e71d6a2e5c1003cf604b0da539513ed3c3c82e&profile_id=164" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                 <div class="absolute inset-0 bg-gradient-to-t from-black/30 to-transparent"></div>
            </div>
            <div class="relative z-10 max-w-4xl mx-auto px-4 py-20 text-center">
                <h1 class="text-5xl md:text-7xl font-bold font-display mb-6 drop-shadow-lg slide-in-up" style="animation-delay: 0.1s;">Our Valencia Adventure</h1>
                <p class="text-xl md:text-2xl mb-10 opacity-90 slide-in-up" style="animation-delay: 0.3s;">Counting down the moments until our new chapter begins in Spain!</p>
                <!-- Countdown Timer -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 max-w-3xl mx-auto slide-in-up" style="animation-delay: 0.5s;">
                    <div class="countdown-unit bg-white/20 dark:bg-black/30 p-4 rounded-lg shadow-md backdrop-blur-sm">
                        <div class="text-4xl lg:text-5xl font-bold font-display" id="days">--</div>
                        <div class="text-sm uppercase tracking-wider opacity-80">Days</div>
                    </div>
                    <div class="countdown-unit bg-white/20 dark:bg-black/30 p-4 rounded-lg shadow-md backdrop-blur-sm">
                        <div class="text-4xl lg:text-5xl font-bold font-display" id="hours">--</div>
                        <div class="text-sm uppercase tracking-wider opacity-80">Hours</div>
                    </div>
                    <div class="countdown-unit bg-white/20 dark:bg-black/30 p-4 rounded-lg shadow-md backdrop-blur-sm">
                        <div class="text-4xl lg:text-5xl font-bold font-display" id="minutes">--</div>
                        <div class="text-sm uppercase tracking-wider opacity-80">Minutes</div>
                    </div>
                    <div class="countdown-unit bg-white/20 dark:bg-black/30 p-4 rounded-lg shadow-md backdrop-blur-sm">
                        <div class="text-4xl lg:text-5xl font-bold font-display" id="seconds">--</div>
                        <div class="text-sm uppercase tracking-wider opacity-80">Seconds</div>
                    </div>
                </div>
                 <div class="mt-12 slide-in-up" style="animation-delay: 0.7s;">
                     <a href="#timeline" class="btn-primary bg-accent-500 hover:bg-accent-600 focus:ring-accent-400 text-white py-3 px-8 text-lg">
                         Follow Our Journey <i class="fas fa-arrow-right ml-2"></i>
                     </a>
                 </div>
            </div>
        </section>

        <!-- Rentals Section -->
        <section id="rentals" class="py-20 bg-gray-100 dark:bg-gray-900">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-6">Finding Our Valencian Home</h2>
                <p class="text-lg text-center text-gray-600 dark:text-gray-400 mb-12 max-w-3xl mx-auto">Exploring potential apartments and neighborhoods for our new life.</p>

                <!-- Filters -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md mb-10">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
                        <div>
                            <label for="area-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Area</label>
                            <select id="area-filter" class="form-select w-full">
                                <option value="">All Areas</option>
                                <option value="Ciutat Vella">Ciutat Vella</option>
                                <option value="Eixample">Eixample</option>
                                <option value="Russafa">Russafa</option>
                                <option value="Extramurs">Extramurs</option>
                                <option value="Benimaclet">Benimaclet</option>
                                <option value="El Cabanyal">El Cabanyal</option>
                            </select>
                        </div>
                        <div>
                            <label for="price-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Max Price</label>
                            <select id="price-filter" class="form-select w-full">
                                <option value="">Any Price</option>
                                <option value="1000">Under €1000</option>
                                <option value="1500">Under €1500</option>
                                <option value="2000">Under €2000</option>
                                <option value="2000+">€2000+</option>
                            </select>
                        </div>
                        <div>
                             <label for="beds-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Min. Bedrooms</label>
                            <select id="beds-filter" class="form-select w-full">
                                <option value="">Any Beds</option>
                                <option value="1">1+ Bedroom</option>
                                <option value="2">2+ Bedrooms</option>
                                <option value="3">3+ Bedrooms</option>
                            </select>
                        </div>
                        <button class="btn-primary w-full sm:w-auto lg:w-full" onclick="filterProperties()">
                            <i class="fas fa-filter mr-2"></i>Filter Listings
                        </button>
                    </div>
                </div>

                <!-- Property Grid -->
                <div id="property-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Property Card 1 -->
                    <div class="card property-card" data-area="Eixample" data-price="1450" data-beds="2">
                        <div class="relative">
                            <img src="https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=870&q=80" alt="Modern Apartment" class="w-full h-56 object-cover">
                             <div class="absolute top-4 right-4 bg-primary-600 text-white px-3 py-1 rounded-full text-sm font-semibold shadow">€1,450/mo</div>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-semibold mb-2">Chic Apartment in Eixample</h3>
                            <div class="flex items-center text-gray-600 dark:text-gray-400 mb-4 text-sm">
                                <i class="fas fa-map-marker-alt mr-2 text-primary-500"></i>
                                <span>Eixample, Valencia</span>
                            </div>
                            <div class="flex justify-between text-sm text-gray-700 dark:text-gray-300 border-t pt-4 mt-4">
                                <span><i class="fas fa-bed mr-1 text-gray-500"></i> 2 Beds</span>
                                <span><i class="fas fa-bath mr-1 text-gray-500"></i> 2 Baths</span>
                                <span><i class="fas fa-ruler-combined mr-1 text-gray-500"></i> 90m²</span>
                            </div>
                        </div>
                    </div>
                    <!-- Property Card 2 -->
                    <div class="card property-card" data-area="Russafa" data-price="1100" data-beds="1">
                        <div class="relative">
                            <img src="https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=870&q=80" alt="Cosy Flat" class="w-full h-56 object-cover">
                             <div class="absolute top-4 right-4 bg-primary-600 text-white px-3 py-1 rounded-full text-sm font-semibold shadow">€1,100/mo</div>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-semibold mb-2">Cosy Flat in Trendy Russafa</h3>
                            <div class="flex items-center text-gray-600 dark:text-gray-400 mb-4 text-sm">
                                <i class="fas fa-map-marker-alt mr-2 text-primary-500"></i>
                                <span>Russafa, Valencia</span>
                            </div>
                            <div class="flex justify-between text-sm text-gray-700 dark:text-gray-300 border-t pt-4 mt-4">
                                <span><i class="fas fa-bed mr-1 text-gray-500"></i> 1 Bed</span>
                                <span><i class="fas fa-bath mr-1 text-gray-500"></i> 1 Bath</span>
                                <span><i class="fas fa-ruler-combined mr-1 text-gray-500"></i> 65m²</span>
                            </div>
                        </div>
                    </div>
                    <!-- Property Card 3 -->
                     <div class="card property-card" data-area="El Cabanyal" data-price="1600" data-beds="3">
                        <div class="relative">
                            <img src="https://images.unsplash.com/photo-1493809842364-78817add7ffb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=870&q=80" alt="Beachside Home" class="w-full h-56 object-cover">
                            <div class="absolute top-4 right-4 bg-primary-600 text-white px-3 py-1 rounded-full text-sm font-semibold shadow">€1,600/mo</div>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-semibold mb-2">Spacious Home near Beach</h3>
                            <div class="flex items-center text-gray-600 dark:text-gray-400 mb-4 text-sm">
                                <i class="fas fa-map-marker-alt mr-2 text-primary-500"></i>
                                <span>El Cabanyal, Valencia</span>
                            </div>
                            <div class="flex justify-between text-sm text-gray-700 dark:text-gray-300 border-t pt-4 mt-4">
                                <span><i class="fas fa-bed mr-1 text-gray-500"></i> 3 Beds</span>
                                <span><i class="fas fa-bath mr-1 text-gray-500"></i> 2 Baths</span>
                                <span><i class="fas fa-ruler-combined mr-1 text-gray-500"></i> 110m²</span>
                            </div>
                        </div>
                    </div>
                     <!-- Property Card 4 (No results message) -->
                     <div id="no-results" class="hidden md:col-span-2 lg:col-span-3 text-center py-10 text-gray-500 dark:text-gray-400">
                         <i class="fas fa-search text-4xl mb-4"></i>
                         <p>No properties match your current filters. Try adjusting your search!</p>
                     </div>
                </div>
            </div>
        </section>

        <!-- Timeline Section -->
        <section id="timeline" class="py-20 bg-white dark:bg-gray-800">
            <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">Our Journey Timeline</h2>

                <div class="relative">
                    <!-- Timeline Line -->
                    <div class="absolute left-1/2 transform -translate-x-1/2 h-full w-1 bg-primary-200 dark:bg-primary-700 rounded-full"></div>

                    <!-- Timeline Items Container -->
                    <div class="space-y-16">
                        <!-- Timeline Item 1 -->
                        <div class="timeline-item">
                            <div class="flex flex-col md:flex-row items-center">
                                <div class="md:w-1/2 md:pr-8 text-center md:text-right mb-4 md:mb-0">
                                    <h3 class="text-xl font-semibold mb-1">The Decision</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">January 2025</p>
                                </div>
                                <div class="timeline-dot"></div>
                                <div class="md:w-1/2 md:pl-8">
                                    <div class="timeline-content">
                                        <p>After much deliberation, we decided to make the leap and move to Valencia!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Timeline Item 2 -->
                        <div class="timeline-item">
                             <div class="flex flex-col md:flex-row-reverse items-center">
                                <div class="md:w-1/2 md:pl-8 text-center md:text-left mb-4 md:mb-0">
                                     <h3 class="text-xl font-semibold mb-1">Research Phase</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Feb - Apr 2025</p>
                                </div>
                                <div class="timeline-dot"></div>
                                <div class="md:w-1/2 md:pr-8">
                                    <div class="timeline-content">
                                        <p>Deep dive into visas, neighborhoods, cost of living, schools, and Spanish culture.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Timeline Item 3 -->
                        <div class="timeline-item">
                            <div class="flex flex-col md:flex-row items-center">
                                <div class="md:w-1/2 md:pr-8 text-center md:text-right mb-4 md:mb-0">
                                    <h3 class="text-xl font-semibold mb-1">Visa Application</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">May 2025</p>
                                </div>
                                <div class="timeline-dot"></div>
                                <div class="md:w-1/2 md:pl-8">
                                    <div class="timeline-content">
                                        <p>Gathering documents and submitting the non-lucrative visa application. Fingers crossed!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Timeline Item 4 (Future) -->
                        <div class="timeline-item opacity-70">
                             <div class="flex flex-col md:flex-row-reverse items-center">
                                <div class="md:w-1/2 md:pl-8 text-center md:text-left mb-4 md:mb-0">
                                    <h3 class="text-xl font-semibold mb-1">Flights Booked!</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Est. May 2026</p>
                                </div>
                                <div class="timeline-dot bg-gray-400 dark:bg-gray-500"></div>
                                <div class="md:w-1/2 md:pr-8">
                                    <div class="timeline-content bg-gray-50 dark:bg-gray-700">
                                        <p>One-way tickets to Valencia purchased. It's getting real!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Timeline Item 5 (Move Date) -->
                        <div class="timeline-item">
                            <div class="flex flex-col md:flex-row items-center">
                                <div class="md:w-1/2 md:pr-8 text-center md:text-right mb-4 md:mb-0">
                                    <h3 class="text-xl font-semibold text-accent-500 mb-1">¡Hola Valencia!</h3>
                                    <p class="text-sm font-bold text-gray-600 dark:text-gray-300" id="move-date-display">July 1, 2026</p>
                                </div>
                                <div class="timeline-dot ring-4 ring-accent-500/50 bg-accent-500"></div>
                                <div class="md:w-1/2 md:pl-8">
                                    <div class="timeline-content border-l-4 border-accent-500">
                                        <p class="font-semibold">The big move day! Our Spanish adventure officially begins.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Weather Section -->
        <section id="weather" class="py-20 bg-gray-100 dark:bg-gray-900">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">Valencia Weather Forecast</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 text-center">
                    <!-- Weather Card Today -->
                    <div class="weather-card card p-6">
                        <div class="text-lg font-semibold mb-2">Today</div>
                        <i class="fas fa-sun text-5xl text-yellow-500 my-4"></i>
                        <div class="text-3xl font-bold">28°C</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Sunny & Clear</div>
                        <div class="text-xs text-gray-500 dark:text-gray-500 mt-3">Feels like 30°C</div>
                    </div>
                    <!-- Weather Card Tomorrow -->
                    <div class="weather-card card p-6 opacity-90">
                        <div class="text-lg font-semibold mb-2">Tomorrow</div>
                        <i class="fas fa-cloud-sun text-5xl text-primary-400 my-4"></i>
                        <div class="text-3xl font-bold">26°C</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Partly Cloudy</div>
                        <div class="text-xs text-gray-500 dark:text-gray-500 mt-3">Wind: 15 km/h</div>
                    </div>
                    <!-- Weather Card Day After -->
                    <div class="weather-card card p-6 opacity-80">
                        <div class="text-lg font-semibold mb-2">Thursday</div>
                        <i class="fas fa-cloud text-5xl text-gray-500 my-4"></i>
                        <div class="text-3xl font-bold">24°C</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Cloudy</div>
                        <div class="text-xs text-gray-500 dark:text-gray-500 mt-3">Humidity: 65%</div>
                    </div>
                     <!-- Weather Card Friday -->
                    <div class="weather-card card p-6 opacity-70">
                        <div class="text-lg font-semibold mb-2">Friday</div>
                        <i class="fas fa-cloud-showers-heavy text-5xl text-blue-400 my-4"></i>
                        <div class="text-3xl font-bold">23°C</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Chance of Showers</div>
                        <div class="text-xs text-gray-500 dark:text-gray-500 mt-3">Precip: 40%</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Schools Section -->
        <section id="schools" class="py-20 bg-white dark:bg-gray-800">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">Exploring International Schools</h2>
                <div class="splide" aria-label="International Schools Carousel">
                    <div class="splide__track">
                        <ul class="splide__list">
                            <!-- School Card 1 -->
                            <li class="splide__slide p-2">
                                <div class="school-card card h-full flex flex-col">
                                    <img src="https://images.unsplash.com/photo-1580582932707-520aed937b7b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80" alt="American School of Valencia" class="w-full h-48 object-cover">
                                    <div class="p-6 flex-grow flex flex-col">
                                        <h3 class="text-xl font-semibold mb-2">American School of Valencia</h3>
                                        <p class="text-gray-600 dark:text-gray-400 mb-4 text-sm flex-grow">Offers American curriculum (IB Diploma option) for ages 3-18. Located in Puzol.</p>
                                        <div class="flex items-center justify-between text-sm mt-auto border-t pt-3">
                                            <span class="text-yellow-500 flex items-center">
                                                <i class="fas fa-star mr-1"></i> 4.8 / 5
                                            </span>
                                            <a href="#" class="text-primary-500 hover:underline">Visit Website</a>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <!-- School Card 2 -->
                            <li class="splide__slide p-2">
                                <div class="school-card card h-full flex flex-col">
                                    <img src="https://images.unsplash.com/photo-1594608661623-aa0bd3a69d98?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80" alt="British School of Valencia" class="w-full h-48 object-cover">
                                     <div class="p-6 flex-grow flex flex-col">
                                        <h3 class="text-xl font-semibold mb-2">British School of Valencia</h3>
                                        <p class="text-gray-600 dark:text-gray-400 mb-4 text-sm flex-grow">Follows the British National Curriculum for ages 2-18. Centrally located.</p>
                                         <div class="flex items-center justify-between text-sm mt-auto border-t pt-3">
                                             <span class="text-yellow-500 flex items-center">
                                                 <i class="fas fa-star mr-1"></i> 4.7 / 5
                                             </span>
                                             <a href="#" class="text-primary-500 hover:underline">Visit Website</a>
                                         </div>
                                    </div>
                                </div>
                            </li>
                             <!-- School Card 3 -->
                            <li class="splide__slide p-2">
                                 <div class="school-card card h-full flex flex-col">
                                    <img src="https://images.unsplash.com/photo-1517486808906-6ca8b3f04846?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80" alt="Caxton College" class="w-full h-48 object-cover">
                                    <div class="p-6 flex-grow flex flex-col">
                                        <h3 class="text-xl font-semibold mb-2">Caxton College</h3>
                                        <p class="text-gray-600 dark:text-gray-400 mb-4 text-sm flex-grow">Private British school offering education from 1-18 years. Located near Puzol.</p>
                                        <div class="flex items-center justify-between text-sm mt-auto border-t pt-3">
                                             <span class="text-yellow-500 flex items-center">
                                                 <i class="fas fa-star mr-1"></i> 4.6 / 5
                                             </span>
                                             <a href="#" class="text-primary-500 hover:underline">Visit Website</a>
                                         </div>
                                    </div>
                                </div>
                            </li>
                            <!-- School Card 4 -->
                            <li class="splide__slide p-2">
                                <div class="school-card card h-full flex flex-col">
                                    <img src="https://images.unsplash.com/photo-1497633762265-9d179a990aa6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=873&q=80" alt="Lycée Français de Valence" class="w-full h-48 object-cover">
                                    <div class="p-6 flex-grow flex flex-col">
                                        <h3 class="text-xl font-semibold mb-2">Lycée Français de Valence</h3>
                                        <p class="text-gray-600 dark:text-gray-400 mb-4 text-sm flex-grow">Offers French national curriculum from Maternelle to Terminale. Located in Paterna.</p>
                                         <div class="flex items-center justify-between text-sm mt-auto border-t pt-3">
                                             <span class="text-yellow-500 flex items-center">
                                                 <i class="fas fa-star mr-1"></i> 4.5 / 5
                                             </span>
                                             <a href="#" class="text-primary-500 hover:underline">Visit Website</a>
                                         </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Combined Planning Section (Budget, Todo, Journal) -->
        <section id="planning" class="py-20 bg-gray-100 dark:bg-gray-900">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">Planning Central</h2>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

                    <!-- Budget Tracker -->
                    <div id="budget" class="lg:col-span-1 card p-6">
                        <h3 class="text-2xl font-semibold mb-6 flex items-center"><i class="fas fa-chart-pie mr-3 text-primary-500"></i>Budget Tracker</h3>
                        <div class="mb-6">
                            <canvas id="budgetChart" class="max-h-64 mx-auto"></canvas>
                        </div>
                        <form id="budget-form" class="space-y-4">
                             <div>
                                <label for="budget-category" class="block text-sm font-medium mb-1">Category</label>
                                <select id="budget-category" class="form-select w-full">
                                    <option value="housing">Housing</option>
                                    <option value="food">Food</option>
                                    <option value="transport">Transportation</option>
                                    <option value="utilities">Utilities</option>
                                    <option value="entertainment">Entertainment</option>
                                    <option value="misc">Miscellaneous</option>
                                </select>
                            </div>
                            <div>
                                <label for="budget-amount" class="block text-sm font-medium mb-1">Amount (€)</label>
                                <input type="number" id="budget-amount" class="form-input w-full" min="0" step="0.01" required placeholder="e.g., 50.00">
                            </div>
                            <button type="submit" class="btn-primary w-full">
                                <i class="fas fa-plus mr-2"></i>Add Expense
                            </button>
                        </form>
                    </div>

                    <!-- Todo List -->
                     <div id="todo" class="lg:col-span-1 card p-6">
                         <h3 class="text-2xl font-semibold mb-6 flex items-center"><i class="fas fa-list-check mr-3 text-accent-500"></i>To-Do List</h3>
                         <form id="todo-form" class="space-y-4 mb-6">
                             <div>
                                 <label for="todo-task" class="block text-sm font-medium mb-1">New Task</label>
                                <input type="text" id="todo-task" class="form-input w-full" required placeholder="What needs to be done?">
                            </div>
                             <div class="grid grid-cols-2 gap-4">
                                 <div>
                                     <label for="todo-date" class="block text-sm font-medium mb-1">Due Date</label>
                                     <input type="date" id="todo-date" class="form-input w-full">
                                 </div>
                                <div>
                                    <label for="todo-priority" class="block text-sm font-medium mb-1">Priority</label>
                                    <select id="todo-priority" class="form-select w-full">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn-primary w-full bg-accent-500 hover:bg-accent-600 focus:ring-accent-400">
                                <i class="fas fa-plus mr-2"></i>Add Task
                            </button>
                         </form>
                         <div class="space-y-3 max-h-96 overflow-y-auto pr-2" id="todo-list">
                             <!-- Todo items will be dynamically added here -->
                             <p class="text-gray-500 dark:text-gray-400 text-center py-4">Your tasks will appear here.</p>
                         </div>
                     </div>

                    <!-- Journal -->
                    <div id="journal" class="lg:col-span-1 card p-6">
                        <h3 class="text-2xl font-semibold mb-6 flex items-center"><i class="fas fa-book-open mr-3 text-green-500"></i>Journey Journal</h3>
                         <form id="journal-form" class="space-y-4 mb-6">
                            <div>
                                <label for="journal-title" class="block text-sm font-medium mb-1">Entry Title</label>
                                <input type="text" id="journal-title" class="form-input w-full" required placeholder="A title for your thoughts">
                            </div>
                            <div>
                                <label for="journal-content" class="block text-sm font-medium mb-1">Content</label>
                                <textarea id="journal-content" rows="4" class="form-textarea w-full" required placeholder="How are you feeling? What happened today?"></textarea>
                            </div>
                            <div>
                                <label for="journal-mood" class="block text-sm font-medium mb-1">Mood</label>
                                <select id="journal-mood" class="form-select w-full">
                                    <option value="excited">😊 Excited</option>
                                    <option value="happy">😄 Happy</option>
                                    <option value="neutral">😐 Neutral</option>
                                    <option value="anxious">😟 Anxious</option>
                                    <option value="stressed">😫 Stressed</option>
                                    <option value="thoughtful">🤔 Thoughtful</option>
                                </select>
                            </div>
                            <button type="submit" class="btn-primary w-full bg-green-600 hover:bg-green-700 focus:ring-green-500">
                               <i class="fas fa-save mr-2"></i> Save Entry
                            </button>
                        </form>
                        <div class="space-y-4 max-h-96 overflow-y-auto pr-2" id="journal-entries">
                            <!-- Journal entries will be dynamically added here -->
                            <p class="text-gray-500 dark:text-gray-400 text-center py-4">Your journal entries will appear here.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- More Tools Section (Map, Bucket List, Resources, Guestbook) -->
        <section id="more-tools" class="py-20 bg-white dark:bg-gray-800">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                 <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">More Tools & Fun</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

                     <!-- Family Map -->
                     <div id="family-map" class="card p-6">
                         <h3 class="text-2xl font-semibold mb-6 flex items-center"><i class="fas fa-map-location-dot mr-3 text-red-500"></i>Family Map</h3>
                         <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Keep track of where loved ones are during the transition.</p>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                              <!-- Family Map Display -->
                            <div>
                                <div id="family-map-container" class="rounded-lg shadow-inner bg-gray-200 dark:bg-gray-700">
                                    <!-- Leaflet map appears here -->
                                </div>
                            </div>
                             <!-- Family Member Form -->
                            <div>
                                <form id="family-form" class="space-y-4">
                                    <div>
                                        <label for="family-name" class="block text-sm font-medium mb-1">Name</label>
                                        <input type="text" id="family-name" class="form-input w-full text-sm" required placeholder="e.g., Mom">
                                    </div>
                                    <div>
                                        <label for="family-location" class="block text-sm font-medium mb-1">Location (City, Country)</label>
                                        <input type="text" id="family-location" class="form-input w-full text-sm" required placeholder="e.g., London, UK">
                                    </div>
                                    <div>
                                         <label for="family-relationship" class="block text-sm font-medium mb-1">Relationship</label>
                                        <select id="family-relationship" class="form-select w-full text-sm">
                                            <option value="parent">Parent</option>
                                            <option value="sibling">Sibling</option>
                                            <option value="child">Child</option>
                                            <option value="friend">Friend</option>
                                            <option value="relative">Other Relative</option>
                                        </select>
                                    </div>
                                    <button type="submit" class="btn-primary w-full text-sm py-2 bg-red-600 hover:bg-red-700 focus:ring-red-500">
                                        <i class="fas fa-user-plus mr-2"></i>Add Person
                                    </button>
                                </form>
                            </div>
                        </div>
                     </div>

                    <!-- Valencia Bucket List -->
                     <div id="bucket-list" class="card p-6">
                         <h3 class="text-2xl font-semibold mb-6 flex items-center"><i class="fas fa-list-ol mr-3 text-purple-500"></i>Valencia Bucket List</h3>
                         <form id="bucket-form" class="space-y-4 mb-6">
                             <div>
                                <label for="bucket-item" class="block text-sm font-medium mb-1">Bucket List Item</label>
                                <input type="text" id="bucket-item" class="form-input w-full" required placeholder="e.g., Eat authentic paella">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="bucket-category" class="block text-sm font-medium mb-1">Category</label>
                                    <select id="bucket-category" class="form-select w-full">
                                        <option value="food">🍽️ Food & Drink</option>
                                        <option value="culture">🏛️ Culture & Arts</option>
                                        <option value="adventure">🚴 Adventure</option>
                                        <option value="learning">📚 Learning</option>
                                        <option value="sightseeing">📍 Sightseeing</option>
                                        <option value="relaxation">🏖️ Relaxation</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="bucket-date" class="block text-sm font-medium mb-1">Target Date</label>
                                    <input type="month" id="bucket-date" class="form-input w-full">
                                </div>
                            </div>
                            <button type="submit" class="btn-primary w-full bg-purple-600 hover:bg-purple-700 focus:ring-purple-500">
                                <i class="fas fa-plus mr-2"></i>Add to List
                            </button>
                         </form>
                          <div class="space-y-3 max-h-96 overflow-y-auto pr-2" id="bucket-list-items">
                            <!-- Bucket list items will be dynamically added here -->
                              <p class="text-gray-500 dark:text-gray-400 text-center py-4">Your Valencia dreams go here!</p>
                          </div>
                     </div>

                    <!-- Helpful Resources -->
                    <div id="resources" class="card p-6">
                        <h3 class="text-2xl font-semibold mb-6 flex items-center"><i class="fas fa-link mr-3 text-teal-500"></i>Helpful Resources</h3>
                        <form id="resource-form" class="space-y-4 mb-6">
                            <div>
                                <label for="resource-title" class="block text-sm font-medium mb-1">Resource Title</label>
                                <input type="text" id="resource-title" class="form-input w-full" required placeholder="e.g., Idealista Spain">
                            </div>
                            <div>
                                <label for="resource-url" class="block text-sm font-medium mb-1">URL</label>
                                <input type="url" id="resource-url" class="form-input w-full" required placeholder="https://www.example.com">
                            </div>
                             <div>
                                <label for="resource-category" class="block text-sm font-medium mb-1">Category</label>
                                <select id="resource-category" class="form-select w-full">
                                    <option value="visa">🛂 Visa/NIE</option>
                                    <option value="housing">🏠 Housing</option>
                                    <option value="education">🎓 Education</option>
                                    <option value="lifestyle">☀️ Lifestyle</option>
                                    <option value="language">🗣️ Language</option>
                                    <option value="finance">💰 Finance</option>
                                    <option value="transport">🚗 Transport</option>
                                    <option value="other">🔗 Other</option>
                                </select>
                            </div>
                            <div>
                                <label for="resource-description" class="block text-sm font-medium mb-1">Description (Optional)</label>
                                <textarea id="resource-description" rows="2" class="form-textarea w-full" placeholder="Brief note about this link..."></textarea>
                            </div>
                            <button type="submit" class="btn-primary w-full bg-teal-600 hover:bg-teal-700 focus:ring-teal-500">
                                <i class="fas fa-plus mr-2"></i>Add Resource
                            </button>
                        </form>
                         <div class="space-y-4 max-h-96 overflow-y-auto pr-2" id="resource-list">
                            <!-- Resources will be dynamically added here -->
                             <p class="text-gray-500 dark:text-gray-400 text-center py-4">Saved links will appear here.</p>
                         </div>
                    </div>

                    <!-- Guestbook -->
                    <div id="guestbook" class="card p-6">
                        <h3 class="text-2xl font-semibold mb-6 flex items-center"><i class="fas fa-comments mr-3 text-pink-500"></i>Guestbook</h3>
                         <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Leave us a message, words of encouragement, or tips!</p>
                        <form id="guestbook-form" class="space-y-4 mb-6">
                            <div>
                                <label for="guest-name" class="block text-sm font-medium mb-1">Your Name</label>
                                <input type="text" id="guest-name" class="form-input w-full" required placeholder="What should we call you?">
                            </div>
                            <div>
                                <label for="guest-message" class="block text-sm font-medium mb-1">Message</label>
                                <textarea id="guest-message" rows="3" class="form-textarea w-full" required placeholder="Share your thoughts..."></textarea>
                            </div>
                             <!-- Optional: Add email field if needed, but consider privacy -->
                             <!-- <div>
                                 <label for="guest-email" class="block text-sm font-medium mb-1">Email (Optional)</label>
                                 <input type="email" id="guest-email" class="form-input w-full" placeholder="your@email.com">
                             </div> -->
                            <button type="submit" class="btn-primary w-full bg-pink-600 hover:bg-pink-700 focus:ring-pink-500">
                                <i class="fas fa-paper-plane mr-2"></i>Send Message
                            </button>
                        </form>
                         <div class="space-y-4 max-h-96 overflow-y-auto pr-2" id="guestbook-entries">
                            <!-- Guestbook entries will be dynamically added here -->
                             <p class="text-gray-500 dark:text-gray-400 text-center py-4">Messages from friends & family.</p>
                         </div>
                    </div>

                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-200 dark:bg-gray-800 text-gray-600 dark:text-gray-400 py-8 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-sm">&copy; <span id="current-year"></span> Our Valencia Adventure. All rights reserved.</p>
            <p class="text-xs mt-1">Built with ❤️ and excitement for Spain!</p>
        </div>
    </footer>


    <!-- Core Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // --- Constants and Config ---
        const MOVE_DATE_STRING = '2026-07-01T00:00:00'; // Your target move date
        const MOVE_DATE = new Date(MOVE_DATE_STRING);
        const VALENCIA_COORDS = [39.4699, -0.3763]; // Center of Valencia

        // --- DOM Elements ---
        const loader = document.getElementById('loader');
        const themeToggleDesktop = document.getElementById('theme-toggle-desktop');
        const themeToggleMobile = document.getElementById('theme-toggle-mobile');
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenuCloseButton = document.getElementById('mobile-menu-close-button');
        const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
        const mobileMenuPanel = document.getElementById('mobile-menu-panel');
        const navLinks = document.querySelectorAll('.nav-link, .mobile-nav-link');
        const currentYearSpan = document.getElementById('current-year');
        const moveDateDisplay = document.getElementById('move-date-display');

        // --- State Variables ---
        let budgetData = {};
        let todos = [];
        let journalEntries = [];
        let familyMembers = [];
        let bucketList = [];
        let resources = [];
        let guestbookEntries = [];
        let familyMap; // Leaflet map instance
        let budgetChartInstance; // Chart.js instance

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Basic Setup
            currentYearSpan.textContent = new Date().getFullYear();
             if (moveDateDisplay) {
                 moveDateDisplay.textContent = MOVE_DATE.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
             }

            // Initialize Theme
            const storedTheme = localStorage.getItem('theme');
            if (storedTheme === 'dark' || (!storedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            updateThemeIcons();

            // Load Data from LocalStorage
            loadData();

            // Initialize Components
            updateCountdown();
            setInterval(updateCountdown, 1000);
            initializeSplide();
            initializeFamilyMap();

            // Initial UI Updates
            updateBudgetChart();
            updateTodoList();
            updateJournalEntries();
            updateFamilyMapMarkers();
            updateBucketList();
            updateResources();
            updateGuestbook();

            // Add Event Listeners
            setupEventListeners();

            // Hide Loader
            setTimeout(() => {
                loader.classList.add('fade-out');
            }, 500); // Keep loader visible for a bit
        });

        // --- Event Listeners Setup ---
        function setupEventListeners() {
            // Theme Toggles
            [themeToggleDesktop, themeToggleMobile].forEach(btn => btn.addEventListener('click', toggleTheme));

            // Mobile Menu
            mobileMenuButton.addEventListener('click', openMobileMenu);
            mobileMenuCloseButton.addEventListener('click', closeMobileMenu);
            mobileMenuOverlay.addEventListener('click', closeMobileMenu);

             // Smooth Scroll & Close Mobile Menu on Nav Click
            navLinks.forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    const href = this.getAttribute('href');
                    if (href && href.startsWith('#')) {
                        e.preventDefault();
                        const targetId = href.substring(1);
                        const targetElement = document.getElementById(targetId);
                        if (targetElement) {
                            // Calculate offset for fixed header
                            const headerOffset = document.querySelector('nav').offsetHeight + 20; // Adjust 20px for spacing
                            const elementPosition = targetElement.getBoundingClientRect().top;
                            const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                             window.scrollTo({
                                top: offsetPosition,
                                behavior: 'smooth'
                            });

                             // Update active link state (simple version)
                            navLinks.forEach(link => link.classList.remove('active'));
                            this.classList.add('active');
                            // Also find corresponding link in other nav (desktop/mobile)
                            document.querySelectorAll(`a[href="${href}"]`).forEach(l => l.classList.add('active'));


                            closeMobileMenu(); // Close menu after clicking a link
                        }
                    }
                });
            });

             // Active link highlighting on scroll
            const sections = document.querySelectorAll('main section[id]');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && entry.intersectionRatio >= 0.5) {
                         navLinks.forEach(link => {
                             link.classList.toggle('active', link.getAttribute('href') === `#${entry.target.id}`);
                         });
                     }
                 });
             }, { rootMargin: "-100px 0px -50% 0px", threshold: 0.5 }); // Adjust rootMargin and threshold

            sections.forEach(section => observer.observe(section));


            // Form Submissions
            handleFormSubmit('budget-form', handleBudgetSubmit);
            handleFormSubmit('todo-form', handleTodoSubmit);
            handleFormSubmit('journal-form', handleJournalSubmit);
            handleFormSubmit('family-form', handleFamilySubmit);
            handleFormSubmit('bucket-form', handleBucketSubmit);
            handleFormSubmit('resource-form', handleResourceSubmit);
            handleFormSubmit('guestbook-form', handleGuestbookSubmit);
        }

        // --- Theme Management ---
        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateThemeIcons();
            // Force chart redraw if needed for dark mode colors
            if (budgetChartInstance) {
                budgetChartInstance.destroy();
                updateBudgetChart();
            }
            // Force map redraw might be needed if using custom tile layers sensitive to theme
            // if (familyMap) familyMap.invalidateSize();
        }

        function updateThemeIcons() {
            const isDark = document.documentElement.classList.contains('dark');
            const iconClass = isDark ? 'fa-sun' : 'fa-moon';
            [themeToggleDesktop, themeToggleMobile].forEach(btn => {
                btn.innerHTML = `<i class="fas ${iconClass} text-lg"></i>`;
            });
        }

        // --- Mobile Menu ---
        function openMobileMenu() {
            mobileMenu.classList.remove('hidden');
            // Delay transform to allow display change first for animation
            requestAnimationFrame(() => {
                mobileMenuOverlay.classList.remove('opacity-0');
                mobileMenuPanel.classList.remove('translate-x-full');
            });
             document.body.style.overflow = 'hidden'; // Prevent background scroll
        }

        function closeMobileMenu() {
            mobileMenuOverlay.classList.add('opacity-0');
            mobileMenuPanel.classList.add('translate-x-full');
            // Hide after transition
            setTimeout(() => {
                mobileMenu.classList.add('hidden');
                document.body.style.overflow = ''; // Restore scroll
            }, 300); // Match transition duration
        }

        // --- Countdown Timer ---
        function updateCountdown() {
            const now = new Date();
            const diff = MOVE_DATE - now;

            const daysEl = document.getElementById('days');
            const hoursEl = document.getElementById('hours');
            const minutesEl = document.getElementById('minutes');
            const secondsEl = document.getElementById('seconds');

            if (diff <= 0) {
                // Move date has passed!
                [daysEl, hoursEl, minutesEl, secondsEl].forEach(el => { if (el) el.textContent = '0'; });
                // Optionally change the hero message
                // document.querySelector('#home h1').textContent = "We Made It to Valencia!";
                // document.querySelector('#home p').textContent = "Our Spanish adventure has begun!";
                return;
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            if (daysEl) daysEl.textContent = String(days).padStart(2, '0');
            if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
            if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
            if (secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');
        }

        // --- Splide Carousel ---
        function initializeSplide() {
            const splideElement = document.querySelector('.splide');
            if (splideElement && typeof Splide !== 'undefined') {
                new Splide(splideElement, {
                    type       : 'loop',
                    perPage    : 3,
                    perMove    : 1,
                    gap        : '1.5rem', // Tailwind gap-6
                    autoplay   : true,
                    interval   : 4000,
                    pauseOnHover: true,
                    pagination : true,
                    arrows     : true,
                     breakpoints: {
                        1024: { // lg breakpoint
                             perPage: 2,
                        },
                         768: { // md breakpoint
                             perPage: 1,
                         },
                     }
                }).mount();
            }
        }

        // --- Leaflet Map ---
        function initializeFamilyMap() {
             const mapContainer = document.getElementById('family-map-container');
            if (mapContainer && typeof L !== 'undefined' && !familyMap) { // Initialize only once
                familyMap = L.map(mapContainer).setView(VALENCIA_COORDS, 6); // Start with a wider view

                // Use a standard tile layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(familyMap);

                 // Add a marker for Valencia itself
                L.marker(VALENCIA_COORDS, { icon: createMarkerIcon('red') })
                     .bindPopup('<b>Valencia!</b><br>Our Destination')
                     .addTo(familyMap)
                     .openPopup();

                updateFamilyMapMarkers(); // Add existing markers
            }
        }

         // Helper for custom marker colors (optional, but nice)
        function createMarkerIcon(color = 'blue') {
             // Simple colored circle icon
             return L.divIcon({
                 className: `custom-div-icon bg-${color}-500`,
                 html: `<div style="background-color:${color};" class="w-3 h-3 rounded-full border-2 border-white shadow-md"></div>`,
                 iconSize: [12, 12],
                 iconAnchor: [6, 6]
             });
         }

        function updateFamilyMapMarkers() {
            if (!familyMap) return;

            // Clear existing family markers (keep the base Valencia marker if desired)
             familyMap.eachLayer((layer) => {
                if (layer.options && layer.options.isFamilyMarker) {
                     familyMap.removeLayer(layer);
                 }
             });

             // Add new markers for family members
             familyMembers.forEach(member => {
                 // Basic geocoding simulation (replace with real geocoding if needed)
                 const lat = member.coordinates ? member.coordinates[0] : VALENCIA_COORDS[0] + (Math.random() - 0.5) * 10; // Wider spread for demo
                 const lng = member.coordinates ? member.coordinates[1] : VALENCIA_COORDS[1] + (Math.random() - 0.5) * 20;

                 L.marker([lat, lng], { isFamilyMarker: true, icon: createMarkerIcon('purple') })
                     .bindPopup(`
                         <strong>${member.name}</strong> (${member.relationship})<br>
                         <em>${member.location}</em>
                     `)
                     .addTo(familyMap);
             });

             // Optionally adjust map bounds to fit markers
             // const bounds = L.latLngBounds(familyMembers.map(m => m.coordinates));
             // if (bounds.isValid()) {
             //     familyMap.fitBounds(bounds.pad(0.5));
             // }
         }

        // --- Property Filtering ---
        function filterProperties() {
            const area = document.getElementById('area-filter').value;
            const priceFilter = document.getElementById('price-filter').value;
            const bedsFilter = document.getElementById('beds-filter').value;

            const cards = document.querySelectorAll('.property-card');
            const noResultsDiv = document.getElementById('no-results');
            let resultsFound = 0;

            cards.forEach(card => {
                let show = true;
                const cardArea = card.dataset.area;
                const cardPrice = parseInt(card.dataset.price);
                const cardBeds = parseInt(card.dataset.beds);

                // Area filter
                if (area && cardArea !== area) {
                    show = false;
                }

                // Price filter (Max Price)
                if (priceFilter) {
                    if (priceFilter.includes('+')) { // Handle '2000+'
                        const minPrice = parseInt(priceFilter.replace('+', ''));
                        if (cardPrice < minPrice) show = false;
                    } else {
                        const maxPrice = parseInt(priceFilter);
                        if (cardPrice > maxPrice) show = false;
                    }
                }

                 // Beds filter (Min Beds)
                if (bedsFilter) {
                    const minBeds = parseInt(bedsFilter);
                    if (cardBeds < minBeds) show = false;
                }

                 // Show/Hide card
                 if (show) {
                     card.style.display = 'block';
                     resultsFound++;
                 } else {
                     card.style.display = 'none';
                 }
             });

             // Show/Hide no results message
             if (noResultsDiv) {
                noResultsDiv.style.display = resultsFound === 0 ? 'block' : 'none';
            }
        }

        // --- Form Handling & Data Updates ---

        // Generic form submit handler
        function handleFormSubmit(formId, handler) {
            const form = document.getElementById(formId);
            if (form) {
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    handler(form); // Pass the form element to the specific handler
                    form.reset(); // Reset form after successful submission
                });
            }
        }

        // Budget
        function handleBudgetSubmit(form) {
            const category = form.querySelector('#budget-category').value;
            const amount = parseFloat(form.querySelector('#budget-amount').value);

            if (category && !isNaN(amount) && amount > 0) {
                budgetData[category] = (budgetData[category] || 0) + amount;
                updateBudgetChart();
                saveData();
            } else {
                alert('Please enter a valid amount.');
            }
        }

        function updateBudgetChart() {
            const ctx = document.getElementById('budgetChart')?.getContext('2d');
            if (!ctx) return;

             // Destroy previous chart instance if it exists
            if (budgetChartInstance) {
                budgetChartInstance.destroy();
            }

             const labels = Object.keys(budgetData).map(k => k.charAt(0).toUpperCase() + k.slice(1));
             const dataValues = Object.values(budgetData);

             // Define color palettes (ensure enough colors)
            const backgroundColors = [
                '#4A6FA5', '#F18F01', '#48A9A6', '#E17F00', '#389996', '#9A6A5C',
                '#0E79B2', '#F3C677', '#BF1363', '#F39C6B', '#8CFF98', '#7D5BA6'
            ];
            const hoverBackgroundColors = backgroundColors.map(color => `${color}B3`); // Add alpha for hover

            budgetChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels.length > 0 ? labels : ['No expenses yet'],
                    datasets: [{
                        data: dataValues.length > 0 ? dataValues : [1], // Show placeholder if no data
                        backgroundColor: dataValues.length > 0 ? backgroundColors.slice(0, dataValues.length) : ['#E5E7EB'], // gray-200
                        hoverBackgroundColor: dataValues.length > 0 ? hoverBackgroundColors.slice(0, dataValues.length) : ['#D1D5DB'], // gray-300
                        borderColor: document.documentElement.classList.contains('dark') ? '#1F2937' : '#FFFFFF', // Match card bg
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#E5E7EB' : '#4B5563', // Match text color
                                padding: 15,
                                boxWidth: 12,
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                     if (dataValues.length === 0) return ' No expenses';
                                     let label = context.label || '';
                                     if (label) {
                                         label += ': ';
                                     }
                                     if (context.parsed !== null) {
                                         label += new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(context.parsed);
                                     }
                                     return label;
                                 }
                             }
                         }
                    },
                    cutout: '65%' // Make it a thinner doughnut
                }
            });
        }

        // Todo List
        function handleTodoSubmit(form) {
            const task = form.querySelector('#todo-task').value.trim();
            const date = form.querySelector('#todo-date').value;
            const priority = form.querySelector('#todo-priority').value;

            if (task) {
                todos.push({ id: Date.now(), task, date, priority, completed: false });
                updateTodoList();
                saveData();
            } else {
                 alert('Please enter a task description.');
             }
        }

        function updateTodoList() {
            const listContainer = document.getElementById('todo-list');
            if (!listContainer) return;

             // Sort todos: incomplete first, then by priority (high -> low), then by date
            todos.sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                const priorityOrder = { high: 0, medium: 1, low: 2 };
                if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
                    return priorityOrder[a.priority] - priorityOrder[b.priority];
                }
                 // Optional: Sort by date if priorities are the same
                 const dateA = a.date ? new Date(a.date) : 0;
                 const dateB = b.date ? new Date(b.date) : 0;
                 if (dateA && dateB) return dateA - dateB;
                 return 0; // Keep order if dates are missing/invalid
             });

             if (todos.length === 0) {
                 listContainer.innerHTML = `<p class="text-gray-500 dark:text-gray-400 text-center py-4">No tasks yet. Add one above!</p>`;
                 return;
             }

            listContainer.innerHTML = todos.map(todo => `
                <div class="todo-item flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-sm slide-in-up" style="animation-duration: 0.3s;">
                    <div class="flex items-center overflow-hidden mr-2">
                        <input type="checkbox" id="todo-${todo.id}" ${todo.completed ? 'checked' : ''}
                               onchange="toggleTodo(${todo.id})" class="mr-3 h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded cursor-pointer">
                        <label for="todo-${todo.id}" class="flex flex-col cursor-pointer overflow-hidden">
                            <span class="font-medium ${todo.completed ? 'line-through text-gray-400 dark:text-gray-500' : ''} truncate">${todo.task}</span>
                            ${todo.date ? `<span class="text-xs text-gray-500 dark:text-gray-400 ${todo.completed ? 'line-through' : ''}">${new Date(todo.date + 'T00:00:00').toLocaleDateString()}</span>` : ''}
                        </label>
                    </div>
                    <div class="flex items-center flex-shrink-0">
                       <span class="px-2 py-0.5 text-xs font-semibold rounded-full ${getPriorityClasses(todo.priority)} mr-2">
                            ${todo.priority}
                        </span>
                         <button onclick="deleteTodo(${todo.id})" class="text-gray-400 hover:text-red-500 transition-colors text-sm" aria-label="Delete task">
                             <i class="fas fa-trash-alt"></i>
                         </button>
                    </div>
                </div>
            `).join('');
        }

        function toggleTodo(id) {
            todos = todos.map(todo => todo.id === id ? { ...todo, completed: !todo.completed } : todo);
            updateTodoList();
            saveData();
        }

         function deleteTodo(id) {
             if (confirm('Are you sure you want to delete this task?')) {
                 todos = todos.filter(todo => todo.id !== id);
                 updateTodoList();
                 saveData();
             }
         }

        function getPriorityClasses(priority) {
            switch (priority) {
                case 'high': return 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200';
                case 'medium': return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200';
                case 'low': return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';
                default: return 'bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-200';
            }
        }

        // Journal
        function handleJournalSubmit(form) {
            const title = form.querySelector('#journal-title').value.trim();
            const content = form.querySelector('#journal-content').value.trim();
            const mood = form.querySelector('#journal-mood').value;
            const date = new Date().toISOString();

            if (title && content) {
                journalEntries.unshift({ id: Date.now(), title, content, mood, date }); // Add to beginning
                updateJournalEntries();
                saveData();
            } else {
                 alert('Please provide both a title and content for your journal entry.');
             }
        }

        function updateJournalEntries() {
            const container = document.getElementById('journal-entries');
            if (!container) return;

             if (journalEntries.length === 0) {
                 container.innerHTML = `<p class="text-gray-500 dark:text-gray-400 text-center py-4">Write your first entry above!</p>`;
                 return;
             }

            container.innerHTML = journalEntries.map(entry => `
                <article class="journal-entry p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-sm slide-in-up" style="animation-duration: 0.3s;">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="text-lg font-semibold text-primary-700 dark:text-primary-300">${entry.title}</h4>
                        <span class="text-2xl flex-shrink-0 ml-2" title="Mood: ${entry.mood}">${getMoodEmoji(entry.mood)}</span>
                    </div>
                    <div class="text-xs text-gray-500 dark:text-gray-400 mb-3">
                         ${new Date(entry.date).toLocaleString()} <!-- Show time as well -->
                     </div>
                    <p class="text-gray-700 dark:text-gray-300 whitespace-pre-wrap break-words">${entry.content}</p>
                    <button onclick="deleteJournalEntry(${entry.id})" class="text-gray-400 hover:text-red-500 text-xs mt-2 float-right" aria-label="Delete entry">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </article>
            `).join('');
        }

         function deleteJournalEntry(id) {
             if (confirm('Are you sure you want to delete this journal entry?')) {
                 journalEntries = journalEntries.filter(entry => entry.id !== id);
                 updateJournalEntries();
                 saveData();
             }
         }

        function getMoodEmoji(mood) {
            const emojis = {
                excited: '😊', happy: '😄', neutral: '😐', anxious: '😟', stressed: '😫', thoughtful: '🤔'
            };
            return emojis[mood] || '📝'; // Default to a pencil icon
        }

        // Family Map
        function handleFamilySubmit(form) {
            const name = form.querySelector('#family-name').value.trim();
            const location = form.querySelector('#family-location').value.trim();
            const relationship = form.querySelector('#family-relationship').value;

            if (name && location) {
                 // For demo, just add with random coords around Valencia.
                 // In a real app, you'd use a Geocoding API here based on 'location'.
                 const lat = VALENCIA_COORDS[0] + (Math.random() - 0.5) * 10;
                 const lng = VALENCIA_COORDS[1] + (Math.random() - 0.5) * 20;

                familyMembers.push({ id: Date.now(), name, location, relationship, coordinates: [lat, lng] });
                updateFamilyMapMarkers();
                saveData();
            } else {
                 alert('Please enter both a name and location.');
             }
        }
        // updateFamilyMapMarkers function already handles drawing


        // Bucket List
        function handleBucketSubmit(form) {
            const item = form.querySelector('#bucket-item').value.trim();
            const category = form.querySelector('#bucket-category').value;
            const date = form.querySelector('#bucket-date').value; // format YYYY-MM

            if (item) {
                bucketList.push({ id: Date.now(), item, category, date, completed: false });
                updateBucketList();
                saveData();
            } else {
                 alert('Please describe your bucket list item.');
             }
        }

        function updateBucketList() {
            const container = document.getElementById('bucket-list-items');
            if (!container) return;

            bucketList.sort((a, b) => a.completed ? 1 : -1); // Show incomplete first

            if (bucketList.length === 0) {
                container.innerHTML = `<p class="text-gray-500 dark:text-gray-400 text-center py-4">What are your Valencia dreams?</p>`;
                return;
            }

            container.innerHTML = bucketList.map(item => `
                <div class="bucket-item flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-sm slide-in-up" style="animation-duration: 0.3s;">
                    <div class="flex items-center overflow-hidden mr-2">
                        <input type="checkbox" id="bucket-${item.id}" ${item.completed ? 'checked' : ''}
                               onchange="toggleBucketItem(${item.id})" class="mr-3 h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded cursor-pointer">
                         <label for="bucket-${item.id}" class="flex flex-col cursor-pointer overflow-hidden">
                            <span class="font-medium ${item.completed ? 'line-through text-gray-400 dark:text-gray-500' : ''} truncate">${item.item}</span>
                             <span class="text-xs text-gray-500 dark:text-gray-400 ${item.completed ? 'line-through' : ''}">
                                ${item.category.split(' ')[0] || ''} <!-- Show emoji only -->
                                ${item.date ? ` • Target: ${formatMonthYear(item.date)}` : ''}
                            </span>
                         </label>
                     </div>
                    <button onclick="deleteBucketItem(${item.id})" class="text-gray-400 hover:text-red-500 transition-colors text-sm flex-shrink-0" aria-label="Delete bucket item">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                 </div>
             `).join('');
        }

        function toggleBucketItem(id) {
            bucketList = bucketList.map(item => item.id === id ? { ...item, completed: !item.completed } : item);
            updateBucketList();
            saveData();
        }

         function deleteBucketItem(id) {
             if (confirm('Are you sure you want to remove this item from your bucket list?')) {
                 bucketList = bucketList.filter(item => item.id !== id);
                 updateBucketList();
                 saveData();
             }
         }

        function formatMonthYear(yyyyMM) {
            if (!yyyyMM) return '';
            const [year, month] = yyyyMM.split('-');
            const date = new Date(year, month - 1);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
        }

        // Resources
        function handleResourceSubmit(form) {
            const title = form.querySelector('#resource-title').value.trim();
            const url = form.querySelector('#resource-url').value.trim();
            const category = form.querySelector('#resource-category').value;
            const description = form.querySelector('#resource-description').value.trim();

             // Basic URL validation
            if (title && url && (url.startsWith('http://') || url.startsWith('https://'))) {
                resources.push({ id: Date.now(), title, url, category, description });
                updateResources();
                saveData();
            } else {
                 alert('Please enter a valid title and URL (starting with http:// or https://).');
             }
        }

        function updateResources() {
            const container = document.getElementById('resource-list');
            if (!container) return;

            if (resources.length === 0) {
                container.innerHTML = `<p class="text-gray-500 dark:text-gray-400 text-center py-4">Save useful links here!</p>`;
                return;
            }

             // Optional: Group by category
            // const groupedResources = resources.reduce((acc, res) => {
            //     (acc[res.category] = acc[res.category] || []).push(res);
            //     return acc;
            // }, {});
            // // Then map over Object.entries(groupedResources)...

            container.innerHTML = resources.map(resource => `
                <div class="resource-item p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-sm slide-in-up" style="animation-duration: 0.3s;">
                     <div class="flex justify-between items-start mb-2">
                         <h4 class="text-md font-semibold flex-grow mr-2">
                             <a href="${resource.url}" target="_blank" rel="noopener noreferrer" class="text-primary-600 dark:text-primary-400 hover:underline break-words">
                                ${resource.title} <i class="fas fa-external-link-alt text-xs ml-1 opacity-60"></i>
                            </a>
                        </h4>
                        <span class="px-2 py-0.5 text-xs font-semibold rounded-full bg-gray-200 text-gray-700 dark:bg-gray-600 dark:text-gray-200 flex-shrink-0">
                            ${resource.category.split(' ')[0] || ''} <!-- Show emoji -->
                         </span>
                    </div>
                     ${resource.description ? `<p class="text-sm text-gray-600 dark:text-gray-400 mb-2">${resource.description}</p>` : ''}
                    <button onclick="deleteResource(${resource.id})" class="text-gray-400 hover:text-red-500 text-xs float-right" aria-label="Delete resource">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                 </div>
             `).join('');
        }

         function deleteResource(id) {
             if (confirm('Are you sure you want to delete this resource?')) {
                 resources = resources.filter(res => res.id !== id);
                 updateResources();
                 saveData();
             }
         }

        // Guestbook
        function handleGuestbookSubmit(form) {
            const name = form.querySelector('#guest-name').value.trim();
            // const email = form.querySelector('#guest-email')?.value.trim(); // Optional
            const message = form.querySelector('#guest-message').value.trim();
            const date = new Date().toISOString();

            if (name && message) {
                guestbookEntries.unshift({ id: Date.now(), name, message, date }); // Add to beginning
                updateGuestbook();
                saveData();
                 alert('Thank you for your message!'); // Give feedback
            } else {
                 alert('Please enter your name and a message.');
             }
        }

        function updateGuestbook() {
            const container = document.getElementById('guestbook-entries');
            if (!container) return;

             if (guestbookEntries.length === 0) {
                 container.innerHTML = `<p class="text-gray-500 dark:text-gray-400 text-center py-4">Be the first to leave a message!</p>`;
                 return;
             }

            container.innerHTML = guestbookEntries.map(entry => `
                <div class="guestbook-entry p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-sm slide-in-up" style="animation-duration: 0.3s;">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200">${entry.name}</h4>
                        <span class="text-xs text-gray-500 dark:text-gray-400">${new Date(entry.date).toLocaleDateString()}</span>
                    </div>
                    <p class="text-gray-700 dark:text-gray-300 whitespace-pre-wrap break-words">${entry.message}</p>
                     <!-- No delete button for guestbook entries usually -->
                 </div>
             `).join('');
        }


        // --- Local Storage Persistence ---
        const STORAGE_KEY = 'valenciaJourneyData';

        function saveData() {
            const dataToSave = {
                budgetData,
                todos,
                journalEntries,
                familyMembers,
                bucketList,

                resources,
                guestbookEntries
            };
            try {
                 localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
             } catch (error) {
                 console.error("Error saving data to localStorage:", error);
                 // Handle potential storage quota exceeded errors
             }
        }

        function loadData() {
             try {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    budgetData = parsedData.budgetData || {};
                    todos = parsedData.todos || [];
                    journalEntries = parsedData.journalEntries || [];
                    familyMembers = parsedData.familyMembers || [];
                    bucketList = parsedData.bucketList || [];
                    resources = parsedData.resources || [];
                    guestbookEntries = parsedData.guestbookEntries || [];
                }
            } catch (error) {
                 console.error("Error loading data from localStorage:", error);
                 // Initialize with empty defaults if loading fails
                 budgetData = {};
                 todos = [];
                 journalEntries = [];
                 familyMembers = [];
                 bucketList = [];
                 resources = [];
                 guestbookEntries = [];
             }
        }

    </script>
</body>
</html>
```